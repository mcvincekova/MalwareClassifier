"""
Test the functionality of the LeNet-5 on the mnist dataset
"""

from tensorflow.keras.datasets import mnist
from tensorflow.keras.optimizers import Adam

from utilities.LeNet5 import LeNet5

(X_train, Y_train), (X_test, Y_test) = mnist.load_data()


def prepare_input_data(x_train_input, x_test_input):

    # Reshape the input data
    x_train = x_train_input.reshape(x_train_input.shape[0], 28, 28, 1)
    x_test = x_test_input.reshape(x_test_input.shape[0], 28, 28, 1)
    x_train = x_train.astype('float32')
    x_test = x_test.astype('float32')

    # Normalize input data
    x_train /= 255
    x_test /= 255

    return x_train, x_test


X_train, X_test = prepare_input_data(X_train, X_test)

adam = Adam(learning_rate=0.001, beta_1=0.9, beta_2=0.999, amsgrad=False)

model = LeNet5((28, 28, 1), 10, "sparse_categorical_crossentropy", adam)

model.fit(x=X_train,
          y=Y_train,
          batch_size=32,
          epochs=10,
          validation_data=(X_test, Y_test),
          verbose=1,
          shuffle=True)

score = model.evaluate(X_test, Y_test)

print()
print('Test Loss= ', score)
